language: java
jdk:
  - openjdk11
git:
  depth: false
addons:
  sonarcloud:
    organization: "sbaudoin-github"
    token:
      secure: "GXJrPWAm6gJItAH18U6ii4v98aTGXlnmgJgnKbmgwES3x90MXeVqEaoWRQOtX6ajONwBQ00QilaUFeO2j2EwhbeARZc5BUjFkyi1SUi5DrLXWPp2xS51afi/jGEqGTmOJqpbf+gSbTkd+8pY+AlEOBjAmgOx5BJUepx/cR/oufVJTd1R6Eyx+kJxQK0ujSj1fq6x54HuGCXZeIitNxpASU1hGrb9Bfn5RPCjjYGhSQ51tE3oDM+WminEm8Zs9NOfCkVlyzUmWl+Nw6iCJG2m6qlslLJnGtQigb7koG6IG/9YpT+P+DbOXs70V27KeILxTmmTg/t7y2uv5F/zps1BKvzqBkzgsjuMEoIVadD65IJasP8a1onNfa6pIXheXUVciAynBySgz64OJLElzbnT4OIzVaqQKivXUqGI4BVmsBJZdLi+JfaS/XFuUec407qCjk1mSMnYZ7FFtTDLqhkxgcIxjwbN1DHzeuYhWAiB4T9ZsY1ETekd2PeEOC5dAm1VYUsOAXHNHs0d1u+Sevsbp1AVeSlI+ZkKbhOjEMt6oQGrcZvZKJwND2Si57FP7L6/1NIJUbGxPmVzGys2Bcdtayg/FlMCyHMc1n7DvhUx98BkPm8CzivQu7ezYlLQM0wupXRJl6xfRKxK0AChsACFGMp1Amj8zfkzBwAgBeUmDE8="
cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
before_install:
  - if [ ! -z "$GPG_SECRET_KEYS" ]; then echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import; fi
  - if [ ! -z "$GPG_OWNERTRUST" ]; then echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust; fi
install:
  - mvn --settings .travis/settings.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=true -B -V
script:
  - mvn clean package sonar:sonar -Dsonar.projectKey=sbaudoin_yamllint -P audit || travis_terminate 1
  - bash it/it.sh
deploy:
  - provider: script
    script: bash .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: sbaudoin/yamllint
      all_branches: true
  - provider: releases
    api_key:
      secure: "XLPQqb794G1PMULyF0L/2OvZV5S+6UNF/HNxnvS3dBr/uPOZsPnG7Uxg+ywEhWzraPCE3G/IEq8iWvxRl3ktpesGDOgoI4FoIYEu97Qf5xQXtxSPqEzc+4MgBl0iqcUMt7YxG5rQiDmHNFYzQ2ZiFMNHNtv9E5ooerjUpt07PkdpnNECMVpMAal8Qu6YBnyNo5Djxff4PlOBVSpJzNlqzxvrCTI1mX3jlG2qwsS0ajl+LkSuSIPHAwAoiAHmU4Iy861wVL2Yiu6IPYcZKTeWgtJ1p3g2EsP/xYZn/1r9lYnSRl84oPcNRWoDsot67J7HR3p7bBquuOcuqj4ccmSOfI27FGTWzSlPQ5aapuafFfbYFFvpxv25/vJ+H2i4r0+xi4pK1fZaXfIPhq3U1UPVN6PZ27JxsNRTht5lmyJ0S2CLUCKwAWv6ck+GAv4/guxEk+AnePkc0SO8lYAh6Can2B76aFrjPd6K5DpnnbphQBeTk35k3k3lWed4LUjFu4Z2jga+1oreWlGO6aagdEkIL0m0khL5NqO2ijHwPzJIQnuJ2qP59XRAyEhAEKD5gURKT61jcrZ3vYbCLhIb2z/bc9CfjuGMVKx1Xm2VSXswCRC0mOvceLcbxOxo6NnU55e4Obvw5j2UIqFSc7Om2iN44g8Wof6MDJysT0LH7ziDoks="
    file_glob: true
    file:
      - target/yamllint-*-distrib.tar.bz2
      - target/yamllint-*-distrib.tar.gz
      - target/yamllint-*-distrib.zip
    skip_cleanup: true
    on:
      repo: sbaudoin/yamllint
      tags: true
